# Configuration Guide

Complete guide to configuring the Leaderboards mod.

## Configuration File

**Location**: `config/leaderboards-server.toml`

This file is automatically generated when the server starts for the first time.

## Configuration Options

### API Settings

```toml
["API Settings"]
    # Enable or disable the HTTP API server
    enableApi = true
    
    # Port for the API server to listen on
    # Range: 1024-65535
    # Default: 8080
    apiPort = 8080
    
    # Enable CORS (Cross-Origin Resource Sharing) headers
    # Set to true to allow web browsers to access the API from different domains
    # Default: true
    corsEnabled = true
    
    # Allowed origins for CORS
    # Use '*' to allow all origins (development/testing only)
    # For production, specify exact domains: "https://example.com,https://other.com"
    # Default: "*"
    allowedOrigins = "*"
```

## Configuration Scenarios

### 1. Development/Testing (Default)

```toml
["API Settings"]
    enableApi = true
    apiPort = 8080
    corsEnabled = true
    allowedOrigins = "*"
```

**Use when**: Testing locally or developing integrations
**Security**: Low - allows all origins

### 2. Production with Website Integration

```toml
["API Settings"]
    enableApi = true
    apiPort = 8080
    corsEnabled = true
    allowedOrigins = "https://myserver.com,https://stats.myserver.com"
```

**Use when**: Running a production server with specific websites
**Security**: Medium - restricts to specified domains

### 3. Local Network Only

```toml
["API Settings"]
    enableApi = true
    apiPort = 8080
    corsEnabled = false
    allowedOrigins = ""
```

**Use when**: API only accessed from server-side applications
**Security**: Medium - no browser CORS access

### 4. API Disabled

```toml
["API Settings"]
    enableApi = false
    apiPort = 8080
    corsEnabled = true
    allowedOrigins = "*"
```

**Use when**: Don't need external API access
**Security**: High - API completely disabled

### 5. Custom Port

```toml
["API Settings"]
    enableApi = true
    apiPort = 9090
    corsEnabled = true
    allowedOrigins = "https://myserver.com"
```

**Use when**: Port 8080 is already in use or want non-standard port
**Security**: Medium - security through obscurity (minor benefit)

## Configuration Details

### Enable API (`enableApi`)

**Type**: Boolean  
**Default**: `true`  
**Valid Values**: `true`, `false`

Controls whether the API server starts at all.

**When to disable**:
- Don't need external access to leaderboards
- Want to minimize server resources
- Security concerns about exposing data

**Note**: Disabling the API does not affect in-game leaderboards.

### API Port (`apiPort`)

**Type**: Integer  
**Default**: `8080`  
**Valid Range**: `1024-65535`

The network port the API server listens on.

**Common ports**:
- `8080` - Common alternative HTTP port
- `3000` - Node.js convention
- `8000` - Python/Django convention
- `9090` - Alternative if 8080 is taken

**Important**:
- Ports below 1024 require administrator privileges on most systems
- Make sure the port is not already in use by another application
- If changing the port, update your firewall rules accordingly

### CORS Enabled (`corsEnabled`)

**Type**: Boolean  
**Default**: `true`  
**Valid Values**: `true`, `false`

Enables Cross-Origin Resource Sharing headers, which allow web browsers to make requests to the API from different domains.

**When to enable**:
- Accessing API from web browsers
- Building web dashboards
- Creating browser-based tools

**When to disable**:
- API only accessed from server-side applications (bots, scripts)
- Don't need browser access
- Want stricter security

### Allowed Origins (`allowedOrigins`)

**Type**: String  
**Default**: `"*"`  
**Format**: Comma-separated list of origins

Specifies which domains are allowed to make CORS requests to the API.

**Examples**:
- `"*"` - Allow all origins (least secure, convenient for development)
- `"https://example.com"` - Allow only one domain
- `"https://example.com,https://api.example.com"` - Allow multiple domains
- `"http://localhost:3000"` - Allow local development server

**Security recommendations**:
- Use `"*"` only for development/testing
- Always specify exact domains in production
- Use HTTPS in production URLs
- Include the protocol (http:// or https://)
- Don't include trailing slashes

## Applying Configuration Changes

Configuration changes require a server restart to take effect.

**Steps**:
1. Stop the Minecraft server
2. Edit `config/leaderboards-server.toml`
3. Save the file
4. Start the Minecraft server
5. Check server logs to confirm API status

## Verification

### Check if API is Running

Look for these messages in the server console:

**API Enabled**:
```
[Leaderboards] Leaderboard API Server started successfully on port 8080 (CORS: enabled)
```

**API Disabled**:
```
[Leaderboards] Leaderboard API server is disabled in config
```

**API Port in Use**:
```
[Leaderboards] Failed to start Leaderboard API Server: Address already in use
```

### Test API Access

```bash
# Test from command line
curl http://localhost:8080/api/leaderboards

# Test from browser
# Visit: http://localhost:8080/api/leaderboards
```

If successful, you should see JSON response with leaderboard data.

## Network Configuration

### Local Access Only

No additional configuration needed. API accessible at:
- `http://localhost:8080`
- `http://127.0.0.1:8080`
- `http://[server-local-ip]:8080` (from other machines on same network)

### External Access (Internet)

**Requirements**:
1. Port forwarding on router
2. Firewall configuration
3. (Optional) Reverse proxy setup
4. (Recommended) SSL/TLS certificate

**Steps**:

1. **Port Forwarding**:
   - Access router admin panel
   - Forward port 8080 to server's local IP
   - Save configuration

2. **Firewall (Windows)**:
   ```powershell
   New-NetFirewallRule -DisplayName "Leaderboards API" -Direction Inbound -LocalPort 8080 -Protocol TCP -Action Allow
   ```

3. **Firewall (Linux)**:
   ```bash
   sudo ufw allow 8080/tcp
   ```

4. **Test External Access**:
   ```bash
   curl http://[your-public-ip]:8080/api/leaderboards
   ```

## Security Best Practices

### Development Environment

```toml
["API Settings"]
    enableApi = true
    apiPort = 8080
    corsEnabled = true
    allowedOrigins = "*"
```

- ✅ Convenient for testing
- ⚠️ Don't use in production

### Production Environment

```toml
["API Settings"]
    enableApi = true
    apiPort = 8080
    corsEnabled = true
    allowedOrigins = "https://yoursite.com"
```

**Additional recommendations**:
1. Use a reverse proxy (nginx, Apache)
2. Enable HTTPS/SSL
3. Implement rate limiting
4. Monitor access logs
5. Keep mod updated
6. Use firewall rules
7. Consider VPN for administrative access

### Maximum Security

```toml
["API Settings"]
    enableApi = false
    apiPort = 8080
    corsEnabled = false
    allowedOrigins = ""
```

- API completely disabled
- Zero external attack surface
- In-game leaderboards still work

## Troubleshooting

### Problem: API not responding

**Solutions**:
1. Check `enableApi = true` in config
2. Verify port is not blocked by firewall
3. Confirm port is not used by another application
4. Check server logs for error messages

### Problem: CORS errors in browser

**Solutions**:
1. Ensure `corsEnabled = true`
2. Add your domain to `allowedOrigins`
3. Use correct protocol (http:// or https://)
4. Clear browser cache

### Problem: Port already in use

**Solutions**:
1. Change `apiPort` to a different port
2. Stop other application using the port
3. Check for multiple server instances

### Problem: Cannot connect from external network

**Solutions**:
1. Verify port forwarding configuration
2. Check firewall rules
3. Confirm using correct public IP address
4. Test from phone (using cellular, not WiFi)

## Example Configurations

### Example 1: Public Community Server

```toml
["API Settings"]
    enableApi = true
    apiPort = 8080
    corsEnabled = true
    allowedOrigins = "https://myserver.net,https://stats.myserver.net,https://dashboard.myserver.net"
```

### Example 2: Private Server with Discord Bot

```toml
["API Settings"]
    enableApi = true
    apiPort = 8080
    corsEnabled = false
    allowedOrigins = ""
```

### Example 3: Development Server

```toml
["API Settings"]
    enableApi = true
    apiPort = 3001
    corsEnabled = true
    allowedOrigins = "*"
```

### Example 4: Minimal Configuration

```toml
["API Settings"]
    enableApi = false
    apiPort = 8080
    corsEnabled = false
    allowedOrigins = ""
```

## Advanced Configuration

### Using Environment Variables

While the mod doesn't support environment variables directly, you can use templating tools to generate the config file:

```bash
# Example using envsubst
envsubst < config-template.toml > config/leaderboards-server.toml
```

### Docker Deployment

```yaml
# docker-compose.yml
services:
  minecraft:
    image: itzg/minecraft-server
    environment:
      EULA: "TRUE"
    ports:
      - "25565:25565"
      - "8080:8080"  # Leaderboards API
    volumes:
      - ./config:/data/config
```

### Kubernetes Deployment

```yaml
apiVersion: v1
kind: Service
metadata:
  name: leaderboards-api
spec:
  type: LoadBalancer
  ports:
    - port: 8080
      targetPort: 8080
  selector:
    app: minecraft-server
```

## Support

For configuration help:
- Check the troubleshooting section above
- Review server logs for error messages
- Consult the API documentation
- Submit issues on GitHub
